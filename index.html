<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Comment Assistant</title>
    <style>
        :root {
            --color-background: #fcfcf9;
            --color-surface: #fffffd;
            --color-text: #134252;
            --color-text-secondary: #626c71;
            --color-primary: #21808d;
            --color-primary-hover: #1d7480;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #21808d;
            --color-warning: #e68161;
            --radius-base: 8px;
            --radius-lg: 12px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #1f2121;
                --color-surface: #262828;
                --color-text: #f5f5f5;
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: #32b8c6;
                --color-primary-hover: #2da6b2;
                --color-border: rgba(119, 124, 124, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 32px;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .card-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #777;
        }

        .status-indicator.active {
            background: var(--color-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .input-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-surface);
            color: var(--color-text);
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-base);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--color-primary-hover);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(94, 82, 64, 0.05);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .btn-group button {
            flex: 1;
        }

        .feed-item {
            padding: 16px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .feed-item:hover {
            border-color: var(--color-primary);
            background: rgba(33, 128, 141, 0.05);
        }

        .feed-item.selected {
            border-color: var(--color-primary);
            background: rgba(33, 128, 141, 0.1);
        }

        .feed-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .feed-item-text {
            font-size: 14px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .comment-preview {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: 16px;
            margin-top: 16px;
        }

        .comment-preview-header {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .comment-text {
            padding: 12px;
            background: rgba(33, 128, 141, 0.05);
            border-radius: var(--radius-base);
            border-left: 3px solid var(--color-primary);
            font-size: 14px;
            line-height: 1.6;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--color-text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .keywords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .keyword-tag {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-primary);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .keyword-tag button {
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0;
        }

        .info-box {
            background: rgba(230, 129, 97, 0.1);
            border: 1px solid rgba(230, 129, 97, 0.3);
            border-radius: var(--radius-base);
            padding: 12px;
            font-size: 13px;
            margin-bottom: 16px;
            color: var(--color-text-secondary);
        }

        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí¨ Telegram Comment Assistant</h1>
            <p class="subtitle">–ü–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Perplexity AI</p>
        </div>

        <div class="grid">
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="card">
                <div class="card-header">
                    <span>‚öôÔ∏è</span>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</span>
                </div>

                <div class="input-group">
                    <label for="apiKey">Perplexity API Key</label>
                    <input type="password" id="apiKey" placeholder="pplx-...">
                </div>

                <div class="input-group">
                    <label for="rssUrl">RSS-–∫–∞–Ω–∞–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</label>
                    <input type="text" id="rssUrl" placeholder="https://rsshub.app/telegram/channel/your_channel">
                    <small style="color: var(--color-text-secondary); font-size: 12px; display: block; margin-top: 4px;">
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: https://rsshub.app/telegram/channel/USERNAME
                    </small>
                </div>

                <div class="input-group">
                    <label for="keywords">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—á–µ—Ä–µ–∑ Enter)</label>
                    <input type="text" id="keywordInput" placeholder="ai, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, python">
                    <div class="keywords-container" id="keywordsContainer"></div>
                </div>

                <div class="input-group">
                    <label for="checkInterval">–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–∏–Ω—É—Ç—ã)</label>
                    <select id="checkInterval">
                        <option value="5">5 –º–∏–Ω—É—Ç</option>
                        <option value="10" selected>10 –º–∏–Ω—É—Ç</option>
                        <option value="15">15 –º–∏–Ω—É—Ç</option>
                        <option value="30">30 –º–∏–Ω—É—Ç</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="dateFilter">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ</label>
                    <select id="dateFilter">
                        <option value="1">1 –¥–µ–Ω—å</option>
                        <option value="3" selected>3 –¥–Ω—è</option>
                        <option value="7">7 –¥–Ω–µ–π</option>
                        <option value="14">14 –¥–Ω–µ–π</option>
                        <option value="30">30 –¥–Ω–µ–π</option>
                        <option value="0">–í—Å–µ –≤—Ä–µ–º—è</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="startMonitoring">–ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
                
                <div style="margin-top: 12px;">
                    <button class="btn btn-secondary" id="testRss" style="width: 100%; font-size: 13px;">
                        üß™ –¢–µ—Å—Ç RSS (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
                    </button>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å -->
            <div class="card">
                <div class="card-header">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</span>
                </div>

                <div class="info-box">
                    ‚ÑπÔ∏è –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã –ø–æ –≤–∞—à–∏–º —Ç–µ–º–∞–º –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è. –í–∞—à –∞–∫–∫–∞—É–Ω—Ç Telegram –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.
                </div>

                <div style="font-size: 13px; color: var(--color-text-secondary);">
                    <div style="margin-bottom: 8px;">
                        <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> <span id="statusText">–ù–µ –∑–∞–ø—É—â–µ–Ω</span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ—Å—Ç–æ–≤:</strong> <span id="postsChecked">0</span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:</strong> <span id="commentsGenerated">0</span>
                    </div>
                    <div>
                        <strong>–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong> <span id="nextCheck">‚Äî</span>
                    </div>
                </div>
            </div>

            <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
            <div class="card full-width">
                <div class="card-header">
                    üì∞ –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –ø–æ –≤–∞—à–∏–º —Ç–µ–º–∞–º
                </div>
                <div id="feedContainer">
                    <div class="empty-state">
                        –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ—Å—Ç–æ–≤
                    </div>
                </div>
            </div>

            <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <div class="card full-width">
                <div class="card-header">
                    ‚úçÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                </div>

                <div id="generationArea" style="display: none;">
                    <div class="input-group">
                        <label>–í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ—Å—Ç:</label>
                        <div id="selectedPostPreview" style="padding: 12px; background: rgba(33, 128, 141, 0.05); border-radius: var(--radius-base); font-size: 14px;"></div>
                    </div>

                    <div class="input-group">
                        <label for="commentStyle">–°—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</label>
                        <select id="commentStyle">
                            <option value="professional">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π</option>
                            <option value="friendly">–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</option>
                            <option value="expert">–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π</option>
                            <option value="question">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" id="generateComment">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>

                    <div id="commentPreviewArea" style="display: none;">
                        <div class="comment-preview">
                            <div class="comment-preview-header">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</div>
                            <div class="comment-text" id="generatedComment"></div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-primary" id="approveComment">‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-secondary" id="regenerateComment">üîÑ –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-secondary" id="editComment">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>

                        <div class="input-group" id="editArea" style="display: none; margin-top: 16px;">
                            <label>–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                            <textarea id="editedComment" rows="4"></textarea>
                            <div class="btn-group" style="margin-top: 8px;">
                                <button class="btn btn-primary" id="saveEdit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-secondary" id="cancelEdit">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="noPostSelected" class="empty-state">
                    –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç –∏–∑ –ª–µ–Ω—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                </div>
            </div>
        </div>
    </div>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            monitoring: false,
            keywords: [],
            selectedPost: null,
            posts: [],
            processedPostIds: new Set(),
            stats: {
                postsChecked: 0,
                commentsGenerated: 0
            },
            checkInterval: null,
            nextCheckTime: null
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadSavedState() {
            const saved = localStorage.getItem('telegramCommentAssistant');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    state.keywords = data.keywords || [];
                    state.processedPostIds = new Set(data.processedPostIds || []);
                    state.stats = data.stats || { postsChecked: 0, commentsGenerated: 0 };
                    if (data.apiKey) elements.apiKey.value = data.apiKey;
                    if (data.rssUrl) elements.rssUrl.value = data.rssUrl;
                    if (data.checkInterval) elements.checkInterval.value = data.checkInterval;
                    if (data.dateFilter) elements.dateFilter.value = data.dateFilter;
                    renderKeywords();
                    updateStats();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function saveState() {
            const dataToSave = {
                apiKey: elements.apiKey.value,
                rssUrl: elements.rssUrl.value,
                checkInterval: elements.checkInterval.value,
                dateFilter: elements.dateFilter.value,
                keywords: state.keywords,
                processedPostIds: Array.from(state.processedPostIds),
                stats: state.stats
            };
            localStorage.setItem('telegramCommentAssistant', JSON.stringify(dataToSave));
        }

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const elements = {
            apiKey: document.getElementById('apiKey'),
            rssUrl: document.getElementById('rssUrl'),
            keywordInput: document.getElementById('keywordInput'),
            keywordsContainer: document.getElementById('keywordsContainer'),
            checkInterval: document.getElementById('checkInterval'),
            dateFilter: document.getElementById('dateFilter'),
            startMonitoring: document.getElementById('startMonitoring'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            postsChecked: document.getElementById('postsChecked'),
            commentsGenerated: document.getElementById('commentsGenerated'),
            nextCheck: document.getElementById('nextCheck'),
            feedContainer: document.getElementById('feedContainer'),
            generationArea: document.getElementById('generationArea'),
            noPostSelected: document.getElementById('noPostSelected'),
            selectedPostPreview: document.getElementById('selectedPostPreview'),
            commentStyle: document.getElementById('commentStyle'),
            generateComment: document.getElementById('generateComment'),
            commentPreviewArea: document.getElementById('commentPreviewArea'),
            generatedComment: document.getElementById('generatedComment'),
            approveComment: document.getElementById('approveComment'),
            regenerateComment: document.getElementById('regenerateComment'),
            editComment: document.getElementById('editComment'),
            editArea: document.getElementById('editArea'),
            editedComment: document.getElementById('editedComment'),
            saveEdit: document.getElementById('saveEdit'),
            cancelEdit: document.getElementById('cancelEdit')
        };

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        elements.keywordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.target.value.trim()) {
                const keyword = e.target.value.trim();
                if (!state.keywords.includes(keyword)) {
                    state.keywords.push(keyword);
                    renderKeywords();
                }
                e.target.value = '';
            }
        });

        function renderKeywords() {
            elements.keywordsContainer.innerHTML = state.keywords.map((kw, index) => `
                <span class="keyword-tag">
                    ${kw}
                    <button onclick="removeKeyword(${index})">√ó</button>
                </span>
            `).join('');
        }

        function removeKeyword(index) {
            state.keywords.splice(index, 1);
            renderKeywords();
        }

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        elements.startMonitoring.addEventListener('click', () => {
            if (!state.monitoring) {
                startMonitoring();
            } else {
                stopMonitoring();
            }
        });

        function startMonitoring() {
            if (!elements.apiKey.value) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Perplexity API Key');
                return;
            }
            if (!elements.rssUrl.value) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ RSS URL');
                return;
            }

            state.monitoring = true;
            elements.startMonitoring.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
            elements.startMonitoring.style.background = '#e68161';
            elements.statusIndicator.classList.add('active');
            elements.statusText.textContent = '–ê–∫—Ç–∏–≤–µ–Ω';

            // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–∑—É
            checkForNewPosts();

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            const intervalMinutes = parseInt(elements.checkInterval.value);
            state.checkInterval = setInterval(checkForNewPosts, intervalMinutes * 60 * 1000);
            updateNextCheckTime(intervalMinutes);
        }

        function stopMonitoring() {
            state.monitoring = false;
            elements.startMonitoring.textContent = '–ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥';
            elements.startMonitoring.style.background = '';
            elements.statusIndicator.classList.remove('active');
            elements.statusText.textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            elements.nextCheck.textContent = '‚Äî';
            
            if (state.checkInterval) {
                clearInterval(state.checkInterval);
                state.checkInterval = null;
            }
        }

        function updateNextCheckTime(minutes) {
            if (!state.monitoring) return;
            
            state.nextCheckTime = new Date(Date.now() + minutes * 60 * 1000);
            elements.nextCheck.textContent = state.nextCheckTime.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ RSS
        async function checkForNewPosts() {
            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤...');
            
            const rssUrl = elements.rssUrl.value.trim();
            if (!rssUrl) return;

            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ RSS
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ RSS');
                }

                const data = await response.json();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                
                // –ü–∞—Ä—Å–∏–Ω–≥ RSS (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)
                const items = xmlDoc.getElementsByTagName('item');
                const entries = xmlDoc.getElementsByTagName('entry'); // Atom —Ñ–æ—Ä–º–∞—Ç
                
                const feedItems = items.length > 0 ? items : entries;
                let newPostsCount = 0;

                for (let i = 0; i < Math.min(feedItems.length, 10); i++) {
                    const item = feedItems[i];
                    
                    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (RSS –∏–ª–∏ Atom)
                    const titleEl = item.getElementsByTagName('title')[0];
                    const linkEl = item.getElementsByTagName('link')[0];
                    const descEl = item.getElementsByTagName('description')[0] || 
                                   item.getElementsByTagName('summary')[0];
                    const pubDateEl = item.getElementsByTagName('pubDate')[0] || 
                                      item.getElementsByTagName('published')[0];
                    
                    if (!titleEl && !descEl) continue;

                    const title = titleEl ? titleEl.textContent : '';
                    const description = descEl ? descEl.textContent : '';
                    const text = (title + ' ' + description).trim();
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
                    const link = linkEl ? (linkEl.getAttribute('href') || linkEl.textContent) : '';
                    const postId = link || text.substring(0, 100);
                    
                    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –∏–∑ RSS
                    const channelEl = xmlDoc.getElementsByTagName('title')[0];
                    const channel = channelEl ? channelEl.textContent : 'Unknown Channel';
                    
                    const timestamp = pubDateEl ? new Date(pubDateEl.textContent) : new Date();
                    
                    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ processedPostIds)
                    const dateFilterDays = parseInt(elements.dateFilter.value);
                    if (dateFilterDays > 0) {
                        const cutoffDate = new Date();
                        cutoffDate.setDate(cutoffDate.getDate() - dateFilterDays);
                        if (timestamp < cutoffDate) {
                            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
                            state.processedPostIds.add(postId);
                            continue;
                        }
                    }
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã
                    if (state.processedPostIds.has(postId)) continue;
                    
                    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
                    if (state.keywords.length > 0 && !matchesKeywords(text)) continue;
                    
                    const post = {
                        id: postId,
                        channel: channel,
                        text: text.length > 500 ? text.substring(0, 500) + '...' : text,
                        timestamp: timestamp,
                        link: link
                    };

                    state.posts.unshift(post);
                    state.processedPostIds.add(postId);
                    newPostsCount++;
                }

                state.stats.postsChecked += newPostsCount;
                
                if (newPostsCount > 0) {
                    renderPosts();
                    updateStats();
                    saveState();
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–∞—Ö
                    if (Notification.permission === 'granted') {
                        new Notification('–ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã!', {
                            body: `–ù–∞–π–¥–µ–Ω–æ ${newPostsCount} –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –ø–æ –≤–∞—à–∏–º —Ç–µ–º–∞–º`,
                            icon: 'üí¨'
                        });
                    }
                }

                console.log(`‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤: ${newPostsCount}`);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ RSS:', error);
                elements.statusText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ RSS';
            }

            updateNextCheckTime(parseInt(elements.checkInterval.value));
        }

        function matchesKeywords(text) {
            const lowerText = text.toLowerCase();
            return state.keywords.some(kw => lowerText.includes(kw.toLowerCase()));
        }

        function renderPosts() {
            if (state.posts.length === 0) {
                elements.feedContainer.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤</div>';
                return;
            }

            elements.feedContainer.innerHTML = state.posts.map((post, index) => `
                <div class="feed-item ${state.selectedPost?.id === post.id ? 'selected' : ''}" onclick="selectPost(${index})">
                    <div class="feed-item-header">
                        <span>${post.channel}</span>
                        <span>${new Date(post.timestamp).toLocaleString('ru-RU')}</span>
                    </div>
                    <div class="feed-item-text">${post.text}</div>
                </div>
            `).join('');
        }

        function selectPost(index) {
            state.selectedPost = state.posts[index];
            renderPosts();
            
            elements.generationArea.style.display = 'block';
            elements.noPostSelected.style.display = 'none';
            elements.commentPreviewArea.style.display = 'none';
            elements.editArea.style.display = 'none';
            
            elements.selectedPostPreview.textContent = state.selectedPost.text.substring(0, 150) + '...';
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        elements.generateComment.addEventListener('click', async () => {
            if (!state.selectedPost) return;

            elements.generateComment.disabled = true;
            elements.generateComment.textContent = '–ì–µ–Ω–µ—Ä–∏—Ä—É—é...';

            try {
                const comment = await generateCommentWithPerplexity();
                elements.generatedComment.textContent = comment;
                elements.commentPreviewArea.style.display = 'block';
                state.stats.commentsGenerated++;
                updateStats();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ' + error.message);
            } finally {
                elements.generateComment.disabled = false;
                elements.generateComment.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π';
            }
        });

        async function generateCommentWithPerplexity() {
            const apiKey = elements.apiKey.value.trim();
            if (!apiKey) {
                throw new Error('–í–≤–µ–¥–∏—Ç–µ Perplexity API Key');
            }

            const postText = state.selectedPost.text;
            const style = elements.commentStyle.value;

            // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è
            const stylePrompts = {
                professional: '–ù–∞–ø–∏—à–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–ª—è—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É –≤ IT –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –ë–µ–∑ —ç–º–æ–¥–∑–∏.',
                friendly: '–ù–∞–ø–∏—à–∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É. –ü–æ–∫–∞–∂–∏ –ª–∏—á–Ω—ã–π –æ–ø—ã—Ç –∏ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ç–µ–º–æ–π. –ë–µ–∑ —ç–º–æ–¥–∑–∏.',
                expert: '–ù–∞–ø–∏—à–∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É. –ó–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Å—å –≥–ª—É–±–æ–∫–∏–º –∏–Ω—Å–∞–π—Ç–æ–º. –ë–µ–∑ —ç–º–æ–¥–∑–∏.',
                question: '–ù–∞–ø–∏—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π-–≤–æ–ø—Ä–æ—Å (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –∫ —ç—Ç–æ–º—É –ø–æ—Å—Ç—É. –ó–∞–¥–∞–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π. –ë–µ–∑ —ç–º–æ–¥–∑–∏.'
            };

            const systemPrompt = `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ IT, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ AI. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –Ω–∞–ø–∏—Å–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É –≤ Telegram-–∫–∞–Ω–∞–ª–µ.

–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –î–ª–∏–Ω–∞: 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 300 —Å–∏–º–≤–æ–ª–æ–≤)
- –ë–ï–ó —ç–º–æ–¥–∑–∏ –∏ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω
- –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
- –î–æ–±–∞–≤–ª—è–π —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –∑–∞–¥–∞–≤–∞–π —É–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã`;

            const userPrompt = `${stylePrompts[style]}

–ü–æ—Å—Ç:
"${postText}"

–¢–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:`;

            try {
                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-sonar-small-128k-online',
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: userPrompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 150
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || '–û—à–∏–±–∫–∞ API');
                }

                const data = await response.json();
                let comment = data.choices[0].message.content.trim();

                // –û—á–∏—Å—Ç–∫–∞ –æ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–∞–≤—ã—á–µ–∫ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ
                comment = comment.replace(/^["']|["']$/g, '');
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã
                if (comment.length > 300) {
                    comment = comment.substring(0, 297) + '...';
                }

                return comment;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ Perplexity API:', error);
                throw new Error(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}`);
            }
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
        elements.approveComment.addEventListener('click', () => {
            const comment = elements.generatedComment.textContent;
            publishComment(comment);
        });

        elements.regenerateComment.addEventListener('click', () => {
            elements.generateComment.click();
        });

        elements.editComment.addEventListener('click', () => {
            elements.editArea.style.display = 'block';
            elements.editedComment.value = elements.generatedComment.textContent;
        });

        elements.saveEdit.addEventListener('click', () => {
            const comment = elements.editedComment.value;
            publishComment(comment);
        });

        elements.cancelEdit.addEventListener('click', () => {
            elements.editArea.style.display = 'none';
        });

        function publishComment(comment) {
            // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            navigator.clipboard.writeText(comment).then(() => {
                const link = state.selectedPost.link || 'Telegram';
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--color-success);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                notification.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 4px;">‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!</div>
                    <div style="font-size: 13px; opacity: 0.9;">–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é</div>
                `;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);

                // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if (link && link.startsWith('http')) {
                    window.open(link, '_blank');
                }
                
                // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
                elements.commentPreviewArea.style.display = 'none';
                elements.editArea.style.display = 'none';
                state.selectedPost = null;
                elements.generationArea.style.display = 'none';
                elements.noPostSelected.style.display = 'block';
                renderPosts();
                
                saveState();
            }).catch(err => {
                alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é:\n\n' + comment);
            });
        }

        // CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updateStats() {
            elements.postsChecked.textContent = state.stats.postsChecked;
            elements.commentsGenerated.textContent = state.stats.commentsGenerated;
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RSS
        document.getElementById('testRss').addEventListener('click', async () => {
            const rssUrl = elements.rssUrl.value.trim();
            if (!rssUrl) {
                alert('–í–≤–µ–¥–∏—Ç–µ RSS URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            const btn = document.getElementById('testRss');
            const originalText = btn.textContent;
            btn.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            btn.disabled = true;
            
            try {
                console.log('üß™ –¢–ï–°–¢ RSS:', rssUrl);
                
                // –¢–µ—Å—Ç 1: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
                console.log('–¢–µ—Å—Ç 1: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ RSS...');
                try {
                    const directResponse = await fetch(rssUrl);
                    console.log('‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø:', directResponse.ok, directResponse.status);
                } catch (e) {
                    console.log('‚ùå –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (CORS)', e.message);
                }
                
                // –¢–µ—Å—Ç 2: –ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
                console.log('–¢–µ—Å—Ç 2: –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...');
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                
                const items = xmlDoc.getElementsByTagName('item');
                const entries = xmlDoc.getElementsByTagName('entry');
                const totalItems = items.length + entries.length;
                
                const channelTitle = xmlDoc.getElementsByTagName('title')[0]?.textContent || 'Unknown';
                
                console.log('‚úÖ RSS –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                console.log('–ö–∞–Ω–∞–ª:', channelTitle);
                console.log('–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤:', totalItems);
                
                alert(`‚úÖ RSS —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n–ö–∞–Ω–∞–ª: ${channelTitle}\n–ü–æ—Å—Ç–æ–≤ –≤ –ª–µ–Ω—Ç–µ: ${totalItems}\n\n–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.`);
                
            } catch (error) {
                console.error('‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RSS\n\n${error.message}\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL\n- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞\n- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ:\n${rssUrl}`);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        });

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        elements.apiKey.addEventListener('change', saveState);
        elements.rssUrl.addEventListener('change', saveState);
        elements.checkInterval.addEventListener('change', saveState);
        elements.dateFilter.addEventListener('change', saveState);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            loadSavedState();
            console.log('‚úÖ Telegram Comment Assistant –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
            console.log('üì± –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ');
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('beforeunload', (e) => {
            if (state.monitoring) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>

